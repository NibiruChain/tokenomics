<img src="nibi-logo-onwhite.png">

# Introduction 

Nibiru is the first decentralized, permissionless trading platform leveraging its own AMM on Cosmos. Nibiru supports leverage, margin trading, spot trading, staking, and bonded liquidity provision. NIBI is the staking and  governance token of the protocol.

Nibiru is a proof-of-stake blockchain and member of a family of interconnected blockchains that comprise the Cosmos Ecosystem. The Cosmos ecosystem's independent, sovereign app-chains require liquidity and diversification of volatility to foster investment into new projects and create ecosystem growth. NIBIRU fulfills this gap by giving ecosystem participants access to leverage through the implementation of several standalone protocols: 

Certain parameters of these applications are tuned via governance using NIBI, the staking and utility token of Nibiru. Staking NIBI enables a user to submit and vote on governance proposals to dictate changes to the Nibiru protocol. NIBI accrues the value generated by the protocol and helps bolster the price-stability of NUSD. Stakers of NIBI also receive staking rewards and can receive higher staking rewards for longer lock-ups. 

### Table of Contents   <!-- omit in toc -->
- [Introduction](#introduction)  
- [Nibiru Perps](#1--nibiru-perps)
- [Automated Market Maker (AMM)](#2--automated-market-maker-amm)
- [NUSD: The Nibiru Stablecoin](#3--nusd-the-nibiru-stablecoin)
- [Appendix](#appendix)
    - [Automated Treasury Management (ATM)](#automated-treasury-management-atm)

---

# 1 — Nibiru Perps 

A perpetual futures contract is a standardized agreement to buy or sell an underlying asset. The key difference with traditional futures is that there is no settlement date. Instead, perpetuals do not expire and remain effective until the trader closes their position. This allows traders to speculate on the future price without having to own the underlying asset. And by using leverage, traders can get exposure to the underlying with only part of the total value in collateral or margin.

Perpetual futures, also called perpetual swaps or "perps", were first proposed by Robert Shiller in 1992 but only became popular when introduced to cryptocurrency markets in 2016 by BitMEX. Perps are the most popular financial instrument in crypto markets, with the trading volume across major centralized exchanges reaching trillions of notional USD value.

## Nibiru Perpetual Futures Exchange

Nibiru Perpetual Futures Exchange (Nibiru Perps, for short)

**Settlement in USDC** - Contracts are denominated and settled in NUSD, providing a versatile settlement currency across the
stablecoin margined futures across all ecosystem.

**No Expiration Date** - You can hold positions without an expiry
    date.

**Clear Pricing Rules** - Each futures contract specifies the base
    asset's quantity delivered for a single contract. For instance,
    OSMO/USDC, UMEE/USDC and ATOM/USDC futures contracts represent only
    one unit of its respective base asset, similar to spot markets.

**Funding payments module**: Funding payments are used to incentivize
traders to take long/short positions. A time-weighted average price from
the DEX pool is taken to compute the mark price. The index price is
derived from an oracle. Funding payments are calculated and exchanged
between traders hourly on Nibiru.

**Perpetual Ecosystem Fund**: To protect the perp protocol against
unexpected events, Nibiru Protocol stores half of the revenue generated
from trading fees in a fund called the PerpEF. This ecosystem fund steps
in to cover the negative value from a bankrupt position that was not
liquidated in time and to pay funding payments that could correct the
skew between the long/short positions.

### Virtual Pools

Positions on Nibiru Perps are priced using virtual liquidity pools with no real assets stored inside. In this model, assets are priced using a $x-y-k$ constant product model pioneered by Uniswap. Tokens are sent to a clearing house, which stores the collateral in a vault and uses the virtual pools for price discovery of the derivatives. This allows for the use of leverage trading and removes the need for liquidity providers, or makers.

There are several open problems Nibiru seeks to address with the perps exchange:

-   **Minimize latency during periods of high volatility**: Design a
    liquidation engine that minimizes latency by liquidating positions
    based on the index price rather than the mark price during periods
    of volatility[^3].

-   **Minimize the imbalance in open interest**: Formulate the correct
    AMM model; to minimize the imbalance between long and short open
    interest.

-   **Increase the number of unique traders on the platform** Enable
    traders, besides arbitrageurs and bots and minimize the insurance
    fund from taking the other side of the trades.

-   **Reduce the bleeding of the ecosystem fund**: The objective of the
    NIBIRU protocol is make sure it keeps the funding rates of the
    listed perps at parity to all other futures perpetual exchanges and
    monitor the opportunity for arbitrageurs.


### Liquidations

When traders use leverage on their positions, they become open to
liquidation risks. When the value of the
<!-- TODO -->

**Liquidation module**: Using leverage traders use NUSD to borrow money
from the exchange to purchase an asset. When the underlying value of a
trader's perp falls, the derivative asset begins to approach the value
of its margin, putting the exchange at risk. To prevent the traders'
position from being under-collateralized, the exchange will proactively
liquidate the traders' position.

NIBURU use partial liquidations; where if the ratio between the asset
value and the margin is above 2%, only a quarter of the position will be
liquidated. Once the margin ratio falls to 7%, the total position is
liquidated.

The liquidations are triggered by **liquidations bots** that earn a
small percentage of the remaining position.

### Clearing House 

When opening a position, tokens are deposited and locked as **margin**
for the position. Under the hood, these tokens are stored with the
**clearing house**, which uses the virtual pools for price discovery by
converting the deposit into virtual assets.

These virtual assets change the reserves of their corresponding pool,
determining the price of the derivative (position) and enabling the use
of leverage. The protocol controls the funding payments in NUSD and
actively monitors the liquidation and the management of the Ecosystem
Fund. The protocol's intention is to solve the following problems
prevalent in the decentralized perp marketplace.

### Perp: NIBI Token 

Holders who stake their NIBI tokens can vote on or propose new ideas to
improve the perps protocol. A small percentage of the protocol's NIBI
inflation feeds into the Ecosystem Fund. NIBI stakers vote on exchange
improvements, parameter alterations, new feature implementations, chain
updates, and alterations to reward mechanisms.

### Perp VIP Trading Program 

Holders who stake their NIBI tokens can vote on or propose new ideas to
improve the perps protocol. 10% of staked NIBI feeds into the ecosystem
fund. The NIBI token acts as a backstop. If the Perp EF is unable to
cover unexpected losses, the protocol will mint new NIBI tokens and
immediately sell them for collateral to keep the system solvent.

NIBI holders will have the ability to vote on exchange improvements,
parameter alterations, new feature implementations, chain updates, and
inflationary reward mechanisms. NIBI stakers enjoy a trading fee
discount proportional to the amount staked.

### What are the risks?

NIBIRU ecosystem is built to promote robust decentralization,
permissionless creation of perps. Community members can start trading
without the supervision of a central authority. New market proposals
will require governance approval for listing and a listing fee in NIBI
tokens.

The permissionless state of market creation can drive the protocol to
in-solvency. NIBIRU doesn't want risk of one market to spill over to
other markets, it requires each new pair to establish an insurance fund
before trading is allowed to commence.

---

# 2 — Automated Market Maker (AMM)

NIBIRU AMM will use the generalized constant product function. The AMM
is a value function which enforces that the product of the asset
balances raised to the asset weight in the pool should always remain
constant. In the formula, $t$ represents the number of assets in the
pool, $\mathcal{Q}_t$ is the quantity of the asset, and $\mathcal{W}_t$
is the asset weight.

$$\mathcal{Q}_1^{W_1} \times \mathcal{Q}_2^{W_2} \times \cdots \times \mathcal{Q}_t^{W_t} = k
$$

NIBIRU takes the values in
and computes $k$: The goal is to keep $k$ constant by only changing the
asset balances while keeping the asset weights constant. Each pair of
tokens in the pool has a price that is dependent on the balance
$\mathcal{Q}$ and weight $\mathcal{W}$ for that specific pair.

Formally, the price that the swap executes at is computed as the ratio
of the token balances normalized by the token weight:

$$\text{Price} = \frac{\mathcal{A}_b/\mathcal{A}_w}{\mathcal{B}_b/\mathcal{B}_w}
$$

Here,
$\mathcal{A}$ represents the token being sold (going into the pool)
while token $\mathcal{B}$ is the token being bought (going out of the
pool). If the pool owner doesn't modify the asset reserves, it is easy
to see that the price changes solely based on trades since the asset
weights must always remain constant.
This ensures that the price of the asset bought increases while the price of
the asset sold decreases. The arbitrage opportunities guarantee that the
prices offered by the pools 
move in conjunction with the rest of the market.

---

# 3 — NUSD: The Nibiru Stablecoin

Nibiru implements a fractional-algorithmic stablecoin NUSD. NIBI serves
as a volatility-absorbing asset and gives NUSD greater capacity for
scaling by helping the system grow with a smaller requirement for
exogenous collateral. For launch, we whitelist USDC as the exogenous and
NIBI as endogenous collateral.

NUSD's creation and annihilation mechanism is dependent on the prices
obtained from the chain's price feed. As a result, arbitrage
opportunities arise when the price of NUSD falls off peg because traders
can profit from secondary markets.

### Collateral Ratio

The **collateral ratio (CR)** is defined as the proportion of NUSD value
that is transacted as collateral during mints and burns of NUSD. For
example, if the collateral ratio is 70% and a user wants to mint 100
NUSD, 70 NUSD worth of collateral and 30 NUSD worth of NIBI are
required. Similarly, if the user instead wants to burn 100 NUSD, she'd
receive an identical proportion of NIBI and collateral.

Nibiru's collateral ratio changes in response to the price of NUSD on
the open market. A decrease in collateral ratio helps support protocol
expansion when the system is growing, while an increase in collateral
during price downturns helps curate system trust. If the price of NUSD
goes too far (pre-determined threshold) below its peg, the collateral
ratio is increased. And if NUSD goes far enough above its peg, the
collateral ratio is decreased. At genesis, the protocol will start out
with a CR of 100%. As users interact with the protocol, the CR will
fluctuate based on the demand for NIBI and NUSD.

### Effect of the Liquidity Ratio on the Collateral Ratio

Nibiru adjusts the Collateral Ratio based on changes in liquidity,
measuring NIBI liquidity against the total supply of NUSD. As the
liquidity of NUSD increases, NIBI liquidity must increase proportionally
to the supply of NUSD, and more NUSD can be redeemed with less of a
percentage impact on NIBI supply. As a result, the system can absorb
more NIBI sell pressure from NUSD redemptions being sold without risking
negative feedback loops.

Nibiru deploys a stability mechanism whereby changes in NUSD supply and
NIBI liquidity adapt to the changes in the market and control the amount
of endogenous collateral backing the system. During sustained periods of
net liquidity ratio change, the market essentially expresses confidence
in the endogenous collateral and signals to the protocol that the CR
should be lower to better facilitate scaling.

The total value of assets locked in the Nibiru ecosystem will always be
less than or equal to the NUSD market cap, so NUSD can more easily adapt
to the pace of increasing stablecoin demand. During sustained periods of
net negative liquidity ratio change, the market signals that more
exogenous collateral should back the system. The exogenous collateral
within the system dampens the reflexive downward spirals that are more
likely to occur in systems entirely reliant upon endogenous collateral.

The **worst-case scenario for NUSD** is if NUSD holders can drain all
the collateral from the system through redemptions, leaving the
remaining holders with improperly collateralized NUSD. While this
scenario is theoretically possible, it's unlikely. The CR is not
designed to rapidly fluctuate so there will not be extended
opportunities in which the CR vastly exceeds the actual percentage of
collateral in the system.

The stability mechanism for NUSD can become more sophisticated over
time, alongside the system's responsiveness to market information. A CR
of 0% implies the market has complete confidence in the endogenous
collateral and no desire for the ability to redeem exogenous collateral,
whereas a CR of 100% implies the market has zero confidence in
endogenous collateral, hindering growth. Nibiru's CR dynamically adjusts
with the growth of the protocol and emergent market intelligence.

# Appendix

### Automated Treasury Management (ATM)

NUSD will implement Automated Treasury Management (ATM), to deploy the
whitelisted exogenous collateral from NUSD minting into various
strategies, while maximizing the core stability mechanism, formalizing
the accounting of the balance sheet, defining how much NIBI can be
bought and burned with profits above that CR. The ATM framework would
enable the deployment of the NUSD into an arbitrarily large set of
strategies to generate revenue, upgrade the system, and enable
partnerships -- all without undermining the price stability of NUSD.

Active ATM would control the NUSD monetary policy and deploy successful
strategies: (*a*)

#### Investor ATM

Investor ATM will deploy NUSD whitelisted collateral to yield
aggregators and money markets. The ATM will allocate funds into
strategies that have a time delay for withdrawals, so it never lowers
the CR and can pull out the collateral if needed for NUSD redemptions

#### AMM ATM

AMM ATM will deploy idle and newly minted NUSD into the NIBI-NUSD pool.
NUSD will utilize this DEX ATM to earn revenue and increase NUSD
liquidity as well as strengthen its peg. NIBURU protocol will create the
NIBI-NUSD pool setting the parameters of the pool. The ATM would build
incentive structure to maximize the LP rewards

#### Lending ATM

Lending ATM would let the borrowing of over-collateralized NUSD into
money markets gives the ATM the ability to increase/decrease NUSD
interest rates through minting and burning. This ATM would control the
NUSD adoption by offering highly competitive borrowing rates

#### Liquidation ATM

would let the deployment of NUSD to capture the yield from liquidation
from the perp and the lending protocols integrated on NIBURU.

The modular design of the ATMs based on its current state makes NUSD
highly adaptive to the market conditions. NIBURU protocol will invest
the excess collateral with ATM strategies to increase stability and
incentivize adoption of NUSD. NUSD will start with whitelisting IBC
assets like UST. Eventually NUSD will utilize a basket of other
stablecoins to maximize the decentralization ratio (extent to how much
decentralized stablecoin system is dependent upon centralized
components).
